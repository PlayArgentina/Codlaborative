@(username: String)(implicit request: RequestHeader)

@main {
<div class="page-header">Hi @username, enter your Scala code</div>

<div class="row">
    <div class="span8">
        <textarea id="editor" rows="15" cols="100" style="resize:none; width:100%"></textarea>
    </div>

    <div class="span4">
        <h3>Developers</h3>
        <ul id="users">
            <li>user1</li>
            <li>user2</li>
            <li>user3</li>
            <li>user4</li>
            <li>user5</li>
        </ul>
    </div>
</div>

<div class="row">
    <div class="span12">
        <div class="well">
            Compiler output ....
        </div>
    </div>
</div>


<script type="text/javascript" charset="utf-8">
    var snapshot = "";
    var dmp = new diff_match_patch();

    window.onload = function () {
        var editor = document.getElementById('editor');

        editor.onkeyup = function(e){

            var diffs = dmp.diff_main(snapshot, editor.value);
            dmp.diff_cleanupSemantic(diffs);
            console.log(diffs);

            snapshot = editor.value;
        }
    };

    $(function() {
			var WS = window['MozWebSocket'] ? MozWebSocket : WebSocket
            var editorSocket = new WS("@routes.Application.join(username).webSocketURL()")

            var sendMessage = function() {
                console.log("editor = " + $("#editor").val());
                editorSocket.send(JSON.stringify(
                    {command: "edit", code: $("#editor").val()}
                ))
            }

            var receiveEvent = function(event) {
                var data = JSON.parse(event.data)

                console.log(event)
                $("#editor").val( data.code )

                // Update the members list
                //$("#users").html('')
                //$(data.members).each(function() {
                //    $("#users").append('<li>' + this + '</li>')
                //})
            }

            $("#editor").keyup(sendMessage)
            editorSocket.onmessage = receiveEvent

        })
</script>
}